name: 'chatgpt-action'
description: 'ChatGPT based PR reviewer and summarizer'
inputs:
  debug:
    required: false
    description: 'Enable debug mode'
    default: 'false'
  temperature:
    required: false
    description: 'Temperature for ChatGPT model'
    default: '0.2'
  path_filters:
    required: false
    description: |
      The path filters, e.g., "src/**.py", "!dist/**", each line will be considered as one pattern.
      See also

      - https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#onpushpull_requestpull_request_targetpathspaths-ignore
      - https://github.com/isaacs/minimatch
    default: |
      !dist/**
      **/package-lock.json
  system_message:
    required: false
    description: 'System message to be sent to ChatGPT'
    default: |
      You are a very experienced software engineer. You are able to thoroughly review code and uncover 
      issues, such as potential data races, livelocks, starvation, suspension, order violation, 
      atomicity violation, consistency issues, complexity issues and so on. 

      We will be doing code reviews today. Please prefer markdown format in your responses.
  chatgpt_reverse_proxy:
    required: false
    description: |
      The URL of the chatgpt reverse proxy, see also https://github.com/transitive-bullshit/chatgpt-api#reverse-proxy
    default: https://chat.duti.tech/api/conversation
  review_comment_lgtm:
    required: false
    description: 'Leave comments even the patch is LGTM'
    default: false
  review_beginning:
    required: false
    description: 'The beginning prompt of a code review dialog'
    default: |
      I will be providing you some files and entire diff to help you build
      context, in case the content is not too large. Then I will be sending you each patch
      from the diff for review.

      I have a pull request with title "$title" and the description is as follows,

      > $description.

      Reply "OK" to confirm that you are ready for further instructions.
  review_file:
    required: false
    description: 'The prompt for each file'
    default: |
      Providing `$filename` content as context. Reply "OK" to confirm.

      ```
      $file_content
      ```
  review_file_diff:
    required: false
    description: 'The prompt for each file diff'
    default: |
      Providing entire diff for `$filename` as context. Reply "OK" to confirm.

      ```diff
      $file_diff
      ```
  review_patch_begin:
    required: false
    description: 'The prompt for each file diff'
    default: |
      Next, I will send you a series of patches, each of them consists 
      of a snippet, and you need to do a brief code review for every message, and tell me any 
      bug risk and improvement suggestion. If the patch is looks good and acceptable, please 
      reply "LGTM!" with a short comment with 30 words. 

      Your answer should be concise. Don't include the diff in your comment, and markdown 
      format is preferred. Reply "OK" to confirm.
  review_patch:
    required: false
    description: 'The prompt for each chunks/patches'
    default: |
      $filename

      ```diff
      $patch
      ```
  summarize_beginning:
    required: false
    description: 'The prompt for the whole pull request'
    default: |
      We will be summarizing a pull request in this session. 

      You will provide -
      - High-level summary of changes that focuses on the purpose and intent (within 100 words)
      - A table containing filename and short summary (within 30 words) for each file's diff

      I have a pull request with title "$title" and the description is as follows,

      > $description.

      Next, I will be providing you diffs for each file for you to summarize. In every response, 
      you will update the high-level summary of the entire pull request, and the table for each file's 
      diff summary.

      Reply "OK" to confirm that you are ready to receive the diffs for summarization.
  summarize_file_diff:
    required: false
    description: 'The prompt for each file diff'
    default: |
      Providing diff for `$filename`.

      I would like you to summarize the diff and add the summary for this file in the table. 

      In response, please provide the updated high-level summary and the summary table of the files 
      we have summarized so far.

      ```diff
      $file_diff
      ```
  summarize:
    required: false
    description: 'The prompt for final summarization response'
    default: |
      This is the end of summarization session. Please provide the final response as follows in 
      the `markdown` format with the following content:
        - High-level Summary
        - Table of files
  summarize_release_notes:
    required: false
    description: 'The prompt for generating release notes'
    default: |
      Next, release notes in `markdown` format for this pull request that focuses on the purpose
      of this PR. If needed, you can classify the changes as "New Feature", "Bug fix", 
      "Documentation", "Refactor", "Style", "Test", "Chore", "Revert" and provide a bullet point list,
      e.g. "New Feature: An integrations page was added to the UI". Your response should be as 
      concise as possible (50-100 words), without additional commentary as this response will be 
      used as is in our release notes.
runs:
  using: 'node16'
  main: 'dist/index.js'
